<div id='bibliography_entities' class='repeatable-field'>
    <div class="fields">
        <%= form.simple_fields_for :bibliography_entities do |entity| %>
            <%= entity.association :entity, 
                label: field_label,
                collection: Entity.all.order(:display_name), 
                prompt: 'Choose an ' + field_label, 
                form_name: 'entity',
                input_html: {class: 'entities'}
            %>
        <% end %>
    </div>
    <div id="bibliography_entity_suggestions">
        <%= form.simple_fields_for :entity_suggestions do |suggestion| %>
            <%= render 'suggest_fields', :form => suggestion, fieldname: 'jesuit' %>
        <% end %>
    </div>
    <div class='links clearfix'>
        <div class="col-sm-2"></div>
        <div class="col-sm-10 btn-add-container">
            <%= link_to_add_association 'Add ' + field_label, 
                form, 
                :bibliography_entities, 
                class: 'btn btn-warning btn-add', 
                form_name: 'form', 
                data: {
                    'association-insertion-node' => '#bibliography_entities .fields', 
                    'association-insertion-method' => 'append'
                }, 
                partial: 'bibliography_entity_fields'
            %>

            <%= link_to_add_association 'Suggest a new Jesuit term', 
                form, 
                :entity_suggestions, 
                class: 'btn btn-warning btn-add', 
                form_name: 'form',
                data: {
                    'association-insertion-node' => '#bibliography_entity_suggestions', 
                    'association-insertion-method' => 'append'
                }, 
                partial: 'suggest_fields',
                render_options: {locals: {fieldname: 'jesuit'}}
            %>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    $('.entities').select2();
    $("#bibliography_entities").on('cocoon:after-insert', function(e, insertedItem){
        $('.entities').last().select2();
    });
});
</script>